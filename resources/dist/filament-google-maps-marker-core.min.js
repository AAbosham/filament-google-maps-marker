function googleMapMarker(t){return{value:t.value,zoom:t.zoom,map:null,markers:[],poly:null,center:{lat:0,lng:0},dispatchFormEvent:function(t,e,s){this.$el.closest("form")?.dispatchEvent(new CustomEvent(t,{statePath:e,uuidToDelete:s}));const o=new CustomEvent(t,{statePath:e,uuidToDelete:s});this.$el.dispatchEvent(o)},drawPolyPath:function(){var t=[];for(polyPathIndex=0;polyPathIndex<this.markers.length;polyPathIndex++){var e=this.markers[polyPathIndex];e.map&&t.push(e.getPosition())}this.poly.setPath(t)},addMarker:function(e,s,o){null!=s&&null!=s||(s="key-"+Date.now());let a=new google.maps.Marker({map:this.map,position:e,draggable:t.options.draggable,label:o??null,extra:{markerId:s}});a.addListener("dblclick",(()=>{for(a.setMap(null),delete this.value[a.extra.markerId],dblclickRemoveMarkerIndex=0;dblclickRemoveMarkerIndex<this.markers.length;dblclickRemoveMarkerIndex++){null==this.markers[dblclickRemoveMarkerIndex].map&&this.markers.splice(dblclickRemoveMarkerIndex,1)}this.drawPolyPath()})),a.addListener("position_changed",(()=>{this.drawPolyPath()})),a.addListener("dragend",(()=>{this.drawPolyPath(),this.value[a.extra.markerId]=a.getPosition().toJSON()})),this.markers.push(a),this.drawPolyPath()},getLastStateValue:function(){return this.value[this.getLastStateKey()]},getLastStateKey:function(){return Object.keys(this.value)[Object.keys(this.value).length-1]},setMarkers:function(){if(this.value){var t=Object.keys(this.value).length;for(setMarkerIndex=0;setMarkerIndex<t;setMarkerIndex++){var e=Object.keys(this.value)[setMarkerIndex];let t=this.value[Object.keys(this.value)[setMarkerIndex]];this.addMarker(t,e,null)}}},removeMarkers:function(){this.markers.map((function(t){t.setMap(null),t.setVisible(!1)}));for(let t=0;t<this.markers.length;t++)this.markers[t].setMap(null),this.markers[t].setVisible(!1);this.markers=[],this.drawPolyPath()},init:function(){if(this.value?this.center=this.value[Object.keys(this.value)[0]]||{lat:0,lng:0}:this.center={lat:0,lng:0},this.map=new google.maps.Map(this.$refs.map,{center:this.center,zoom:t.options.zoom,mapTypeId:t.options.mapTypeId,...t.controls}),this.poly=new google.maps.Polyline({strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:3,geodesic:!0,map:this.map}),this.setMarkers(),Livewire.on("update-markers-data",(({data:t})=>{t&&(this.value=t,this.removeMarkers(),this.setMarkers())})),this.map.addListener("click",(e=>{if((t.options.multiple||!(this.markers.length>0))&&!(t.maxItems>0&&this.markers.length>0&&this.markers.length>=t.maxItems)){0==this.markers.length&&(this.value={});var s="key-"+Date.now(),o=e.latLng.toJSON();this.value[s]=o,this.addMarker(e.latLng.toJSON(),s,null)}})),t.options.fixMarkerOnCenter&&(this.map.addListener("drag",(t=>{markers[0].setPosition(this.map.getCenter())})),this.map.addListener("dragend",(t=>{markers[0].setPosition(this.map.getCenter()),this.value[0]=this.map.getCenter().toJSON()}))),t.controls.geolocationControl){const t=this.$refs.locationButton;this.map.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(t),t.addEventListener("click",(()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition((t=>{const e={lat:t.coords.latitude,lng:t.coords.longitude};this.addMarker(e),this.map.setCenter(e)}),(()=>{console.log("Browser supports Geolocation but got error. Probably no permission granted.")})):console.log("Browser doesn't support Geolocation")}))}if(t.options.defaultToMyLocation&&0===this.center.lat&&0===this.center.lng&&(navigator.geolocation?navigator.geolocation.getCurrentPosition((t=>{const e={lat:t.coords.latitude,lng:t.coords.longitude};let s={};s["key-"+Date.now()]=e,this.value=s,this.addMarker(e),this.map.setCenter(e)}),(()=>{console.log("Browser supports Geolocation but got error. Probably no permission granted.")})):console.log("Browser doesn't support Geolocation")),t.controls.searchBoxControl){const e=this.$refs.searchBox,s=new google.maps.places.SearchBox(e);this.map.controls[google.maps.ControlPosition.TOP_CENTER].push(e),s.addListener("places_changed",(()=>{e.value="";var o=s.getPlaces()[0].geometry.location;t.options.multiple||0==this.markers.length?(this.markers[0],this.map.setCenter(o)):(this.markers[0].setPosition(o),this.map.setCenter(o))}))}t.controls.coordsBoxControl&&(actionsControl=this.$refs.actionsBox,this.map.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(actionsControl)),this.$watch("value",(()=>{let t=this.getLastStateValue();t&&(this.map.setCenter(t),this.map.panTo(t))}))}}}
